# AOP & 프록시 AOP

## ✅ AOP란❓

---

> AOP란 **핵심 비즈니스 로직과 공통 관심 사항을 분리하여**, 코드의 모듈화를 높이는 프로그래밍 기법이다.
>

### ✔️ AOP의 장점

- **코드의 모듈화**: 공통 관심사항을 별도의 Aspect로 분리하여 코드의 중복을 줄이고 모듈화를 높인다.
- **유지보수 용이성**: 공통 기능을 한 곳에서 관리할 수 있어서 유지보수가 쉬워진다.
- **가독성 증가**: 핵심 비즈니스 로직과 공통 관심 사항을 분리하여 가독성이 좋아진다.

## ✅ 스프링의 프록시 AOP

---

> 프록시 AOP란 **프록시 패턴**을 활용하여 AOP를 구현할 수 있도록 해주는 프로그래밍 패러다임이다.
>
- 프록시 AOP는 주로 기존 객체를 프록시 객체로 감싸서 **메소드 실행 전 후에 추가 로직을 삽입**하거나 **메서드 실행을 감싸는 방식**으로 동작한다.
- 주로 **트랜잭션 관리, 보안, 로깅** 등에 사용된다.

### ✔️ 프록시 패턴

---

> 실제 객체에 대한 대리 객체를 사용하여 **실제 객체의 접근을 제어**하거나, **추가적인 기능을 부여**하도록 하는 디자인 패턴.
>
- 프록시 객체는 실제 객체에 대한 대리자 역할을 하며,
  클라이언트는 프록시를 통해 실제 객체에 **간접적으로 접근**하게 된다.
- 이를 통해 객체 생성 비용을 줄이거나, 접근 권한을 제어하거나, 객체에 대한 추가적인 작업을 수행할 수 있다.
- 비용이 많이 드는 작업을 **나중에 수행하기 위해** 사용된다.

### ✔️ 핵심 개념

---

- **횡단 관심사**

  : 어떤 코드에서도 동일하게 적용되는 **공통 기능.** (ex, 로깅, 보안 검사, 트랜잭션 관리 등)

- **관점**

  : 횡단 관심사를 모듈화한 것.

- **어드바이스**

  : 실제로 실행되는 부가기능 로직

- **타겟 객체**

  : 실제 핵심 로직을 수행하는 객체로, AOP 프록시에 의해 감싸지는 객체.


### ✔️ 정리

---

쉽게 말해서, 어떤 기능을 하는 클래스에서 횡단 관심사를 분리하여 이를 프록시 객체에 구현하고, 프록시 객체에서 **구현한 로직 사이에 실제 객체나 메서드를 감싸는 방식으로 수행**하는 프로그래밍 방식이다.

## ✅ 프록시 AOP 관점에서 @Transactional 살펴보기

---

> `@Transactional`은 AOP와 프록시를 사용해 트랜잭션 관리를 간편하게 수행하는 기능이다.
>
- 이 어노테이션을 메서드나 클래스에 붙이면 해당 메서드나 클래스 내의 **트랜잭션 관리 로직이 자동으로 처리된다.**

### ✔️ @Transactional의 동작 원리

---

1. **프록시 객체 생성**
    - `@Transactional`이 적용된 클래스나 메서드를 스프링이 빈으로 생성할 때, 프록시 객체가 생성된다.
2. **프록시가 메서드 호출 감지 및 트랜잭션 처리**
    - 클라이언트가 @Transactional이 붙은 메서드를 호출하면, 프록시 객체가 해당 호출을 가로챈다.
    - 프록시는 호출된 메서드에 트랜잭션을 시작한다.
3. **타겟 메서드 실행 및 트랜잭션 종료**
    - 트랜잭션이 시작되면 프록시는 실제 타겟 메서드를 호출하고, 메서드가 정상적으로 실행되면 트랜잭션을 커밋한다.
    - 만약 메서드 실행 중에 예외가 발생하면, 트랜잭션을 롤백하여 데이터의 일관성을 보장한다.

### ✔️ 실제 동작 방식을 코드로 살펴보기

```java
public class OrderServiceTransactionProxy implements OrderService{
	@Override
    public List<Order> createOrders(List<OrderReq> reqs) {
        return new TransactionTemplate(transactionManager).execute(status ->
                    // 프록시 객체에서 트랜잭션으로 감싸고, 리턴으로 실제 객체 호출하기.
                    target.createOrders(reqs)
        );
    }
}
```